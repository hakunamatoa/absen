<!DOCTYPE html>
<html>
  <head>
    <title>Absen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
      window.onload = function () {
        const params = new URLSearchParams(window.location.search);
        const nama = params.get('nama') || "N/A";
        const barcode = params.get('barcode') || "N/A";

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (pos) {
            const lokasi = pos.coords.latitude + "," + pos.coords.longitude;
            const url = "https://script.google.com/macros/s/AKfycbzKW3sqY3iA28F5iwaAfONUzmk102556WPGLJ7DNTiCJEOzGvqbXF1009S7qfkiateg/exec" +
                        "?nama=" + encodeURIComponent(nama) +
                        "&barcode=" + encodeURIComponent(barcode) +
                        "&lokasi=" + encodeURIComponent(lokasi);

            // Tampilkan spinner atau pesan loading
            document.body.innerHTML = "<h3>‚è≥ Memproses...</h3>";

            // Kirim data ke Google Apps Script dengan fetch()
            fetch(url)
              .then(response => {
                if (!response.ok) {
                  throw new Error('Gagal mengirim data');
                }
                return response.json();
              })
              .then(data => {
                // Setelah data berhasil dikirim
                document.body.innerHTML = "<h3>‚úÖ Absen berhasil dikirim!</h3>";
              })
             .catch(error => {
                // Jika terjadi error saat mengirim data
               document.body.innerHTML = "<h3>‚ùå Gagal mengirim absen. Coba lagi.</h3>";
          //    });
          }, function (err) {
            document.body.innerHTML = "<p>‚ùå Gagal ambil lokasi: " + err.message + "</p>";
          });
        } else {
          document.body.innerHTML = "<p>‚ùå Browser tidak mendukung lokasi.</p>";
        }
      };
    </script>
  </head>
  <body>
    <h3>üìç Mengambil lokasi dan mengirim absen...</h3>
  </body>
</html>
